<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Game of Scoot ‚Äî RIDLY</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#22c55e">

<!-- Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="js/env.js"></script>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --green:#22c55e;
  --green-dark:#16a34a;
  --bg:#000;
  --panel:#0b1220;
  --text:#fff;
  --dim:#9aa5b1;
  --border:rgba(255,255,255,.15);
}

/* THEMES */
body.theme-dark{
  --bg:#000;
  --panel:#0b1220;
  --text:#fff;
  --dim:#9aa5b1;
  --border:rgba(255,255,255,.15);
}
body.theme-light{
  --bg:#f3f4f6;
  --panel:#fff;
  --text:#020617;
  --dim:#4b5563;
  --border:rgba(15,23,42,.12);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Outfit,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  display:flex;
  flex-direction:column;
}
main{flex:1}

/* ==== BG VID√âO ==== */
.rsl-bg-wrap{position:fixed;inset:0;z-index:0;pointer-events:none}
.rsl-bg-video{
  position:absolute;inset:0;width:100%;height:100%;
  object-fit:cover;background:#000;
  filter:brightness(.55) saturate(1.05);
}
.rsl-bg-dim{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.55))}
body.theme-light .rsl-bg-dim{background:linear-gradient(180deg,rgba(255,255,255,.8),rgba(255,255,255,.96))}

/* ==== NAV FIXE (corrig√©e) ==== */
nav.nav{
  position:sticky;
  top:0;
  z-index:1000;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(8px);
  border-bottom:1px solid rgba(255,255,255,.12);
  height:62px;
}
body.theme-light nav.nav{
  background:rgba(243,244,246,.9);
  border-bottom:1px solid rgba(15,23,42,.1);
}
nav.nav .row{
  max-width:1200px;
  margin:0 auto;
  height:62px;
  padding:0 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
nav.nav .brand{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:800;
  color:var(--text);
  text-decoration:none;
}
nav.nav .brand img{
  height:40px !important;
  width:40px !important;
  object-fit:contain;
  border-radius:12px;
  background:#000;
  padding:4px;
  box-shadow:0 0 10px rgba(34,197,94,.6);
  transition:none !important;
}
nav.nav .brand span{
  font-size:18px !important;
  line-height:1;
}
.nav-tools{
  display:flex;
  gap:8px;
  align-items:center;
  margin-left:auto;
}
.icon-btn{
  border:1px solid var(--border);
  background:rgba(0,0,0,.8);
  color:var(--text);
  border-radius:999px;
  width:34px;height:34px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;
  font-size:16px;
  text-decoration:none;
  position:relative;
}
body.theme-light .icon-btn{background:#e5e7eb;}
.icon-btn:hover{border-color:var(--green);color:var(--green);}
.chat-dot{
  position:absolute;top:5px;right:6px;width:8px;height:8px;border-radius:50%;
  background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.9);opacity:0;
}

/* ===== TITRE ===== */
.page-mini-hero{position:relative;z-index:10;padding:12px 0 6px}
.page-mini-hero .container{max-width:1200px;margin:0 auto;padding:0 20px}
.page-mini-hero h1{margin:0 0 6px;font-size:clamp(24px,4vw,34px);font-weight:800}
.page-mini-hero p{margin:0;color:var(--dim);font-size:14px;max-width:720px}

/* ===== GAME PANELS ===== */
main .container{max-width:980px;margin:0 auto 110px;padding:0 16px 40px;position:relative;z-index:10}
.panel{
  background:rgba(15,23,42,.9);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 30px 60px rgba(0,0,0,.85);
}
body.theme-light .panel{background:var(--panel);box-shadow:0 18px 45px rgba(15,23,42,.15);}
h2,h3{margin:0 0 10px;}
.btn{
  appearance:none;
  border:1px solid var(--border);
  background:rgba(255,255,255,.06);
  color:var(--text);
  border-radius:10px;
  padding:10px 16px;
  font:800 13px Outfit;
  cursor:pointer;
}
.btn.green{
  background:linear-gradient(180deg,var(--green),var(--green-dark));
  color:#062312;
  border:0;
  box-shadow:0 10px 24px rgba(0,0,0,.5);
}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
input{
  background:#020617;
  border-radius:10px;
  border:1px solid var(--border);
  padding:8px 10px;
  color:#fff;
  font:500 14px Outfit;
  min-width:0;
}
body.theme-light input{background:#f9fafb;color:#020617;border-color:rgba(15,23,42,.15);}
.players{display:flex;justify-content:space-between;gap:12px;margin-bottom:12px;flex-wrap:wrap;}
.player-card{flex:1;min-width:130px;padding:12px;border-radius:12px;background:rgba(15,23,42,.95);border:1px solid rgba(148,163,184,.4);}
body.theme-light .player-card{background:var(--panel);border-color:var(--border);}
.letters{display:flex;gap:4px;margin-top:6px;}
.letter{width:24px;height:24px;border-radius:6px;border:1px solid rgba(148,163,184,.5);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:var(--dim);}
.letter.on{background:rgba(34,197,94,.15);color:var(--green);border-color:var(--green);}
.status{font-size:13px;color:var(--dim);margin-bottom:6px;}
.round-log{max-height:220px;overflow:auto;font-size:13px;color:var(--dim);padding-top:4px;}
.round-log div{padding:2px 0;border-bottom:1px solid rgba(15,23,42,1);}
body.theme-light .round-log div{border-bottom-color:rgba(148,163,184,.2);}

/* ===== TABBAR ===== */
.tabbar{
  position:fixed;left:0;right:0;bottom:0;
  z-index:2000;
  display:flex;align-items:center;justify-content:space-around;
  padding:14px 18px;
  border-top:1px solid var(--border);
  background:rgba(0,0,0,.78);
  backdrop-filter:blur(10px);
}
body.theme-light .tabbar{background:rgba(243,244,246,.96);}
.tab{display:flex;flex-direction:column;align-items:center;gap:4px;text-decoration:none;}
.tab .ic{font-size:24px}
.tab span{font-size:13px;color:#e5e7eb;font-weight:700}
body.theme-light .tab span{color:#111827}
.tab.active span{color:#22c55e}
</style>
</head>

<body>
<!-- BG vid√©o -->
<div class="rsl-bg-wrap" aria-hidden="true">
  <video class="rsl-bg-video" id="rslBg" autoplay muted loop playsinline preload="auto"></video>
  <div class="rsl-bg-dim"></div>
</div>

<!-- NAV -->
<nav class="nav">
  <div class="row">
    <a class="brand" href="ou_rider.html">
      <img src="image/1logo_ridly.png" alt="RIDLY"/>
      <span>RIDLY</span>
    </a>
    <div class="nav-tools">
      <button type="button" class="icon-btn" id="btnTheme" title="Mode clair / sombre">üåô</button>
      <a href="chat.html" class="icon-btn" id="btnChat" title="Chat riders">
        <span class="chat-dot" id="chatDot"></span>üí¨
      </a>
    </div>
  </div>
</nav>

<script>
(function(){
  const saved=localStorage.getItem('ridlyTheme')||'dark';
  const prefersDark=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;
  const theme=(saved==='light'||saved==='dark')?saved:(prefersDark?'dark':'light');
  document.body.classList.add(theme==='light'?'theme-light':'theme-dark');
  const btnTheme=document.getElementById('btnTheme');
  const updateIcon=()=>{const isLight=document.body.classList.contains('theme-light');btnTheme.textContent=isLight?'‚òÄÔ∏è':'üåô';};
  updateIcon();
  btnTheme.addEventListener('click',()=>{
    const isLight=document.body.classList.contains('theme-light');
    document.body.classList.toggle('theme-light',!isLight);
    document.body.classList.toggle('theme-dark',isLight);
    localStorage.setItem('ridlyTheme',isLight?'dark':'light');
    updateIcon();
  });
})();
</script>

<!-- HERO -->
<section class="page-mini-hero">
  <div class="container">
    <h1>Game of Scoot</h1>
    <p>Cr√©e une partie, partage le code √† ton pote, et suivez vos lettres SCOOT en direct.</p>
  </div>
</section>

<main>
  <div class="container">
    <p class="status" id="statusText">Connecte-toi pour jouer.</p>

    <div class="panel">
      <h2>Lancer une partie</h2>
      <div class="row" style="margin-bottom:10px;">
        <button class="btn green" id="btnCreateGame">Cr√©er une partie</button>
        <span id="createdCode" style="font-size:13px;color:var(--dim);"></span>
      </div>

      <h3>Rejoindre une partie</h3>
      <div class="row">
        <input id="joinCode" placeholder="Code (ex: ABC123)" style="flex:1;max-width:220px"/>
        <button class="btn" id="btnJoinGame">Rejoindre</button>
      </div>
    </div>

    <div class="panel" id="gamePanel" style="display:none;">
      <div class="players">
        <div class="player-card"><div id="p1Name">P1</div><div class="letters" id="p1Letters"></div></div>
        <div class="player-card"><div id="p2Name">P2</div><div class="letters" id="p2Letters"></div></div>
      </div>
      <div class="status" id="gameStatus"></div>
      <div class="row" style="margin-bottom:8px;">
        <input id="trickName" placeholder="Nom du trick" style="flex:1;"/>
      </div>
      <div class="row" style="margin-bottom:10px;">
        <button class="btn" id="btnP1Miss">P1 prend une lettre</button>
        <button class="btn" id="btnP2Miss">P2 prend une lettre</button>
      </div>
      <div class="round-log" id="roundLog"></div>
    </div>
  </div>
</main>

<!-- TABBAR -->
<nav class="tabbar" aria-label="Navigation">
  <a class="tab" href="ou_rider.html"><div class="ic">üè†</div><span>Spots</span></a>
  <a class="tab" href="ajouter.html"><div class="ic">‚ûï</div><span>Ajouter</span></a>
  <a class="tab" href="feed.html"><div class="ic">üé¨</div><span>Feed</span></a>
  <a class="tab" href="recherche.html"><div class="ic">üîé</div><span>Recherche</span></a>
  <a class="tab active" href="games.html"><div class="ic">üéÆ</div><span>Game</span></a>
  <a class="tab" href="classement.html"><div class="ic">üèÜ</div><span>Classement</span></a>
  <a class="tab" href="profil_ou_rider.html"><div class="ic">üë§</div><span>Profil</span></a>
</nav>

<script>
const SUPABASE_URL  = window.env?.SUPABASE_URL || "https://jynxifufaauoxwzjapzq.supabase.co";
const SUPABASE_ANON = window.env?.SUPABASE_ANON || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
(function(){const v=document.getElementById('rslBg');if(!v)return;const s=document.createElement('source');s.src=SUPABASE_URL+"/storage/v1/object/public/ridly/ridly.mp4";s.type="video/mp4";v.appendChild(s);const play=()=>{try{v.playbackRate=0.6;const p=v.play();if(p&&p.catch)p.catch(()=>{});}catch(e){}};play();document.addEventListener('visibilitychange',()=>{document.hidden?v.pause():play();});})();
</script>
</body>
</html>
