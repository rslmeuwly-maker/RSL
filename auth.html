<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/+esm'

  const supabaseUrl = 'https://jynxifufaouxwjzapzq.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp5bnhpZnVmYWF1b3h3emphcHpxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzODI2NzcsImV4cCI6MjA3Njk1ODY3N30.vFPGhGakPIM3Xg5rn8_BrAXl6oJMJOssO780C9nXmr4';

  const supabase = createClient(supabaseUrl, supabaseKey);
  const msg = document.getElementById('msg');

  // üîé Diagnostic r√©seau/CORS
  (async () => {
    try {
      const r = await fetch(`${supabaseUrl}/auth/v1/settings`, {
        headers: { apikey: supabaseKey }
      });
      if (r.ok) {
        msg.textContent = '‚úÖ Ping Supabase OK';
      } else {
        msg.textContent = `‚ùå Ping Supabase: HTTP ${r.status}`;
      }
    } catch (e) {
      msg.textContent = '‚ùå R√©seau/CORS: ' + (e?.message || e);
      console.error('Ping error:', e);
    }
  })();

  // inscription
  document.getElementById('signup').addEventListener('submit', async (e) => {
    e.preventDefault();
    try {
      const { error } = await supabase.auth.signUp({
        email: email.value,
        password: password.value,
        options: { data: { full_name: name.value } }
      });
      msg.textContent = error ? '‚ùå ' + error.message : '‚úÖ Compte cr√©√©, v√©rifie ton email.';
    } catch (e) {
      msg.textContent = '‚ùå R√©seau: ' + (e?.message || e);
      console.error(e);
    }
  });

  // connexion
  document.getElementById('login').addEventListener('submit', async (e) => {
    e.preventDefault();
    try {
      const { error } = await supabase.auth.signInWithPassword({
        email: lemail.value,
        password: lpass.value
      });
      msg.textContent = error ? '‚ùå ' + error.message : '‚úÖ Connect√© !';
    } catch (e) {
      msg.textContent = '‚ùå R√©seau: ' + (e?.message || e);
      console.error(e);
    }
  });
</script>
