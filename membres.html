<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Membres ‚Äî Romandie Scooter League</title>

  <!-- Fonts + styles globaux -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/common.css"/>

  <!-- Supabase + scripts -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script defer src="js/env.js"></script>
  <script defer src="js/auth.js"></script>
  <script defer src="js/site.js"></script>

  <style>
    :root{
      --rsl-bg:#020617;
      --rsl-fg:#e5e7eb;
      --rsl-muted:#9ca3af;
      --rsl-card:rgba(15,23,42,.96);
      --rsl-card-soft:rgba(15,23,42,.9);
      --rsl-border:rgba(148,163,184,.45);
      --rsl-accent:#22c55e;
      --rsl-accent-soft:rgba(34,197,94,.14);
    }

    body.theme-light{
      --rsl-bg:#f3f4f6;
      --rsl-fg:#0f172a;
      --rsl-muted:#6b7280;
      --rsl-card:#ffffff;
      --rsl-card-soft:#f9fafb;
      --rsl-border:rgba(148,163,184,.35);
      --rsl-accent:#16a34a;
      --rsl-accent-soft:rgba(22,163,74,.12);
    }

    *,:before,:after{ box-sizing:border-box; }

    html,body{
      height:100%;
      margin:0;
      background:transparent!important;
      display:flex;
      flex-direction:column;
      color:var(--rsl-fg);
      font-family:"Outfit",system-ui,-apple-system,Segoe UI,Roboto,Arial;
      overflow-x:hidden;
    }
    main{ flex:1; }

    /* ======= Fond vid√©o ======= */
    .site-bg-video{
      position:fixed; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      z-index:-2;
      background:#000;
    }
    .site-bg-dim{
      position:fixed; inset:0;
      z-index:-1;
      background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,.9));
      transition:background .25s ease;
    }
    body.theme-light .site-bg-dim{
      background:linear-gradient(180deg,rgba(249,250,251,.9),rgba(15,23,42,.85));
    }

    /* ======= NAVBAR ======= */
    nav.nav{
      background:rgba(0,0,0,.65);
      backdrop-filter:blur(10px);
      position:sticky; top:0; z-index:100;
      transition:background .25s ease, border-color .25s ease, box-shadow .25s ease;
      border-bottom:1px solid rgba(15,23,42,.8);
    }
    nav.nav .container{ max-width:1320px; margin:0 auto; padding:10px 18px; }
    nav.nav .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }

    body.theme-light nav.nav{
      background:rgba(248,250,252,.96);
      border-bottom:1px solid rgba(148,163,184,.5);
      box-shadow:0 10px 30px rgba(15,23,42,.06);
    }

    .brand{
      display:flex; align-items:center; gap:10px;
      color:inherit; text-decoration:none;
      min-width:fit-content;
    }
    .brand img{
      height:42px; border-radius:10px;
      display:block;
      background:#fff;
      padding:3px;
      box-shadow:0 10px 28px rgba(0,0,0,.35);
    }
    .brand span{
      font-weight:800;
      letter-spacing:.2px;
      font-size:16px;
      white-space:nowrap;
    }

    nav.nav ul{
      display:flex; align-items:center; gap:20px;
      padding:0; margin:0;
      list-style:none;
    }
    nav.nav ul li a{
      font-weight:600;
      color:var(--rsl-fg);
      font-size:15px;
      letter-spacing:.02em;
      white-space:nowrap;
      text-decoration:none;
      opacity:.9;
      transition:.2s ease;
    }
    nav.nav ul li a:hover{
      color:var(--rsl-accent);
      opacity:1;
    }

    .cta{ display:flex; align-items:center; gap:10px; }

    .btn{
      border-radius:999px;
      padding:8px 14px;
      font-size:14px;
      font-weight:700;
      border:1px solid rgba(148,163,184,.5);
      text-decoration:none;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:rgba(15,23,42,.9);
      color:#f9fafb;
      transition:.2s ease;
      line-height:1;
      white-space:nowrap;
    }
    body.theme-light .btn{
      background:#0f172a;
      color:#f9fafb;
      border-color:#0f172a;
    }
    .btn.green{
      background:var(--rsl-accent);
      color:#052e16;
      border-color:transparent;
      box-shadow:0 10px 26px rgba(22,163,74,.45);
    }
    .btn:hover{ transform:translateY(-1px); filter:brightness(1.05); }

    .nav-avatar{
      width:34px; height:34px;
      border-radius:999px;
      object-fit:cover;
      border:2px solid var(--rsl-accent);
      box-shadow:0 0 10px rgba(34,197,94,.5);
      display:block;
    }

    .theme-toggle{
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      background:rgba(15,23,42,.9);
      color:#e5e7eb;
      width:34px; height:34px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:17px;
      cursor:pointer;
      padding:0;
      transition:.2s ease;
      line-height:1;
    }
    .theme-toggle:hover{ transform:translateY(-1px); filter:brightness(1.08); }
    body.theme-light .theme-toggle{
      background:#ffffff;
      color:#0f172a;
      border-color:rgba(148,163,184,.7);
    }

    #menuBtn{
      display:none;
      align-items:center;
      justify-content:center;
      padding:7px 10px;
      font-size:18px;
      line-height:1;
      border-radius:10px;
      border:1px solid rgba(148,163,184,.4);
      background:rgba(15,23,42,.9);
      color:#e5e7eb;
      cursor:pointer;
      transition:.2s ease;
    }
    #menuBtn:hover { filter:brightness(1.1); }
    body.theme-light #menuBtn{
      background:#0f172a;
      color:#f9fafb;
      border-color:#0f172a;
    }

    .container{ max-width:1200px; margin:0 auto; padding:0 16px; }

    /* ===== Menu mobile ===== */
    .mobile-sheet{ position:fixed; inset:0; display:none; z-index:120; }
    .mobile-sheet.open{ display:block; }
    .mobile-dim{ position:absolute; inset:0; background:rgba(0,0,0,.55); }
    .mobile-panel{
      position:absolute; top:0; right:0; height:100%;
      width:82vw; max-width:360px;
      background:var(--rsl-card);
      padding:22px 18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      border-left:1px solid rgba(15,23,42,.8);
      box-shadow:-18px 0 50px rgba(0,0,0,.55);
    }
    .mobile-panel a{
      color:var(--rsl-fg);
      text-decoration:none;
      font-weight:700;
      padding:6px 0;
      font-size:14px;
    }
    .mobile-panel hr{
      border:0;
      height:1px;
      background:rgba(148,163,184,.4);
      margin:10px 0;
    }

    @media (max-width:990px){
      nav.nav ul{ display:none !important; }
      #btnCart, .btn.green{ display:none !important; }
      #menuBtn{ display:inline-flex; }
    }

    /* ======= MEMBRES ======= */
    .shop-wrap{
      max-width:1200px;
      margin:36px auto 40px;
      padding:0 16px 50px;
    }

    .intro-card{
      background:var(--rsl-card);
      border-radius:22px;
      border:1px solid var(--rsl-border);
      box-shadow:0 30px 80px rgba(15,23,42,.9);
      padding:22px 22px 22px;
      position:relative;
      overflow:hidden;
      max-width:100%;
    }
    body.theme-light .intro-card{
      box-shadow:0 24px 60px rgba(15,23,42,.16);
    }
    .intro-card:before{
      content:"";
      position:absolute; inset:-40% -30%;
      background:
        radial-gradient(circle at 20% 25%, rgba(34,197,94,.18), transparent 55%),
        radial-gradient(circle at 85% 20%, rgba(34,197,94,.12), transparent 60%),
        radial-gradient(circle at 60% 90%, rgba(99,102,241,.10), transparent 62%);
      pointer-events:none;
      z-index:0;
    }
    .intro-inner{ position:relative; z-index:1; }

    .badge-partner{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 12px;
      border-radius:999px;
      background:rgba(15,23,42,.95);
      border:1px solid rgba(148,163,184,.7);
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.14em;
      color:var(--rsl-muted);
      white-space:nowrap;
      margin-bottom:10px;
    }
    body.theme-light .badge-partner{ background:#f9fafb; }
    .badge-partner span{
      width:7px;height:7px;
      border-radius:999px;
      background:var(--rsl-accent);
      box-shadow:0 0 10px rgba(34,197,94,.9);
    }

    .shop-intro h1{
      font-size:clamp(26px,4vw,36px);
      margin:0 0 10px;
      font-weight:800;
      letter-spacing:.02em;
      color:var(--rsl-fg);
    }
    .shop-intro p{
      margin:0 0 10px;
      font-size:14px;
      color:var(--rsl-muted);
      max-width:78ch;
      line-height:1.65;
    }
    .shop-intro b{ color:var(--rsl-fg); }

    .why-block{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:16px;
      margin-top:14px;
    }
    @media(max-width:900px){
      .why-block{ grid-template-columns:1fr; }
    }
    .why-card{
      border-radius:16px;
      border:1px solid var(--rsl-border);
      background:var(--rsl-card-soft);
      padding:14px 16px;
      font-size:13px;
      color:var(--rsl-fg);
      box-shadow:0 16px 50px rgba(15,23,42,.75);
    }
    body.theme-light .why-card{ box-shadow:0 18px 44px rgba(15,23,42,.12); }
    .why-card h3{
      margin:0 0 6px;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.14em;
      color:var(--rsl-muted);
    }
    .why-card ul{ margin:0; padding-left:18px; color:var(--rsl-muted); line-height:1.65; }
    .why-card li{ margin:3px 0; }

    .plans-title{
      margin-top:18px;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:var(--rsl-muted);
    }

    .products-grid{
      margin-top:14px;
      display:grid;
      grid-template-columns:repeat(5,minmax(0,1fr));
      gap:14px;
      align-items:stretch;
    }
    @media(max-width:1150px){ .products-grid{ grid-template-columns:repeat(3,minmax(0,1fr)); } }
    @media(max-width:820px){ .products-grid{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
    @media(max-width:520px){ .products-grid{ grid-template-columns:1fr; } }

    .product-card{
      background:var(--rsl-card-soft);
      border-radius:18px;
      border:1px solid var(--rsl-border);
      box-shadow:0 20px 50px rgba(0,0,0,.65);
      padding:14px 14px 16px;
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
      overflow:hidden;
    }
    body.theme-light .product-card{ box-shadow:0 18px 44px rgba(15,23,42,.12); }

    .product-card.highlight{
      border-color:var(--rsl-accent);
      box-shadow:0 24px 70px rgba(34,197,94,.22);
    }

    .product-ribbon{
      position:absolute;
      top:10px;
      right:-30px;
      transform:rotate(35deg);
      background:linear-gradient(135deg,var(--rsl-accent),#16a34a);
      color:#052e16;
      font-size:10px;
      font-weight:900;
      padding:4px 32px;
      text-transform:uppercase;
      letter-spacing:.15em;
    }

    .product-img{
      width:100%;
      border-radius:14px;
      overflow:hidden;
      background:
        radial-gradient(circle at 15% 0%, rgba(34,197,94,.22), transparent 55%),
        linear-gradient(180deg, rgba(2,6,23,.85), rgba(2,6,23,.95));
      aspect-ratio:16/7;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color:var(--rsl-muted);
      border:1px solid rgba(148,163,184,.25);
    }

    .product-title{
      font-size:15px;
      font-weight:900;
      margin-top:2px;
      color:var(--rsl-fg);
      letter-spacing:.01em;
    }

    .product-meta{
      font-size:13px;
      color:var(--rsl-muted);
      line-height:1.55;
    }
    .product-meta ul{
      margin:6px 0 0;
      padding-left:18px;
    }
    .product-meta li{ margin:3px 0; }

    .product-price{
      font-size:16px;
      font-weight:900;
      margin-top:2px;
      color:var(--rsl-fg);
    }
    .product-price span{
      font-size:12px;
      font-weight:700;
      color:rgba(165,180,252,.9);
      margin-left:6px;
    }

    .product-btn{
      margin-top:auto;
      display:inline-block;
      text-align:center;
      padding:10px 10px;
      border-radius:12px;
      font-size:13px;
      font-weight:900;
      text-decoration:none;
      background:linear-gradient(180deg,var(--rsl-accent),#16a34a);
      color:#052e16;
      box-shadow:0 12px 26px rgba(0,0,0,.55);
      cursor:pointer;
    }
    .product-btn:hover{ filter:brightness(1.05); transform:translateY(-1px); transition:.15s ease; }

    .badge-small{
      display:inline-block;
      margin-top:6px;
      padding:4px 8px;
      font-size:11px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.55);
      color:var(--rsl-muted);
      width:fit-content;
    }

    /* Footer */
    .footer-mini .copy{
      text-align:center;
      color:var(--rsl-muted);
      font-size:13px;
      padding:20px 0 24px;
      margin:0;
      border-top:1px solid rgba(15,23,42,.7);
      background:rgba(15,23,42,.85);
    }
    body.theme-light .footer-mini .copy{
      background:rgba(248,250,252,.96);
      border-top-color:rgba(148,163,184,.5);
    }

    /* ===== Modal ===== */
    .product-modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:1500;
    }
    .product-modal.open{ display:flex; }
    .product-modal-backdrop{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,.7);
    }
    body.theme-light .product-modal-backdrop{ background:rgba(15,23,42,.6); }

    .product-modal-panel{
      position:relative;
      max-width:520px;
      width:92vw;
      max-height:80vh;
      background:var(--rsl-bg);
      border-radius:18px;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 25px 80px rgba(0,0,0,.9);
      padding:18px 18px 20px;
      overflow-y:auto;
      z-index:1;
      color:var(--rsl-fg);
    }
    body.theme-light .product-modal-panel{
      background:#ffffff;
      box-shadow:0 20px 55px rgba(15,23,42,.18);
    }

    .product-modal-close{
      position:absolute;
      top:10px;
      right:12px;
      border:none;
      background:transparent;
      color:var(--rsl-muted);
      font-size:20px;
      cursor:pointer;
    }

    .product-modal-content h2{
      margin:0 0 6px;
      font-size:18px;
      font-weight:900;
      color:var(--rsl-fg);
    }
    .product-modal-content h3{
      margin:12px 0 6px;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.12em;
      color:var(--rsl-muted);
    }
    .product-modal-content p{
      font-size:14px;
      line-height:1.6;
      color:var(--rsl-fg);
      margin:6px 0 10px;
    }
    .product-modal-content ul{
      padding-left:18px;
      margin:6px 0 10px;
      font-size:14px;
      color:var(--rsl-fg);
      line-height:1.6;
    }

    @media(max-width:520px){
      .shop-wrap{ padding:0 12px 46px; }
      .intro-card{ padding:18px 14px 18px; border-radius:16px; }
      .products-grid{ gap:12px; }
      .product-card{ border-radius:16px; }
    }
  </style>
</head>
<body>

  <!-- Fond vid√©o -->
  <video class="site-bg-video" autoplay muted loop playsinline id="rslBg" poster="images/hero-poster.jpg"></video>
  <div class="site-bg-dim" aria-hidden="true"></div>

  <!-- NAV -->
  <nav class="nav">
    <div class="container">
      <div class="row">
        <a class="brand" href="index.html">
          <img src="images/logo_rsl.png" alt="Logo RSL"/>
          <span>RSL ‚Äî Romandie Scooter League</span>
        </a>

        <ul>
          <li><a href="cours.html">Cours</a></li>
          <li><a href="formation.html">Formation RSL</a></li>
          <li><a href="ou_rider.html">O√π rider ?</a></li>
          <li><a href="evenements.html">√âv√©nements</a></li>
          <li><a href="disciplines.html">Disciplines</a></li>
          <li><a href="shop-rsl.html">Shop</a></li>
          <li><a href="comite.html">Comit√©</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>

        <div class="cta">
          <button id="themeToggle" class="theme-toggle" aria-label="Changer le th√®me">üåô</button>

          <a class="btn" id="btnLogin" href="access.html">Login</a>
          <a class="btn" id="btnAccount" href="compte.html" style="display:none">Mon compte</a>

          <a href="compte.html" aria-label="Mon compte">
            <img id="navAvatar" class="nav-avatar" src="images/default-avatar.png" alt="Avatar" style="display:none;">
          </a>

          <a class="btn" id="btnCart" href="panier/panier.html">Panier</a>
          <a class="btn green" href="membres.html" aria-current="page">Devenir membre</a>
          <button id="menuBtn" aria-label="Menu">‚ò∞</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- MENU MOBILE -->
  <div class="mobile-sheet" id="mobileMenu" aria-hidden="true">
    <div class="mobile-dim"></div>
    <nav class="mobile-panel">
      <a href="index.html">Accueil</a>
      <a href="cours.html">Cours</a>
      <a href="membres.html" aria-current="page">Devenir membre</a>
      <a href="formation.html">Formation RSL</a>
      <a href="disciplines.html">Disciplines</a>
      <a href="ou_rider.html">O√π rider ?</a>
      <a href="evenements.html">√âv√©nements</a>
      <a href="game.html">Games</a>
      <a href="shop-rsl.html">Shop</a>
      <a href="comite.html">Comit√©</a>
      <a href="contact.html">Contact</a>
      <a href="conditions.html">Conditions g√©n√©rales</a>
      <a href="access.html">Se connecter</a>
      <a href="compte.html">Mon compte</a>
      <a href="coach.html" class="coach-link">üë®‚Äçüè´ Je suis coach</a>
    </nav>
  </div>

  <!-- CONTENU -->
  <main>
    <div class="shop-wrap" id="plans">
      <section class="intro-card">
        <div class="intro-inner">
          <div class="shop-intro">
            <div class="badge-partner">
              <span></span> Devenir membre ‚Ä¢ Romandie Scooter League
            </div>
            <h1>Choisis ta formule RSL et rejoins la ligue</h1>
            <p>
              √Ä la RSL, on a simplifi√© tous les tarifs pour arriver √† <b>5 formules claires</b>.
              Tu peux commencer petit, progresser avec le temps ou soutenir la sc√®ne comme un boss.
            </p>
            <p>
              Que tu sois <b>rider</b>, <b>parent</b>, <b>coach</b> ou juste fan de trottinette freestyle,
              il y a une formule pour toi. Le but : te donner un cadre, des cours, des events, et faire
              grandir la sc√®ne ensemble.
            </p>

            <div class="why-block">
              <div class="why-card">
                <h3>Pourquoi devenir membre ?</h3>
                <ul>
                  <li>Acc√®s prioritaire aux cours & events RSL</li>
                  <li>Infos et pr√©inscriptions avant le public</li>
                  <li>Encadrement s√©curis√© & p√©dagogique</li>
                  <li>Tu soutiens une ligue cr√©√©e par des riders</li>
                </ul>
              </div>
              <div class="why-card">
                <h3>Concr√®tement, tu gagnes</h3>
                <ul>
                  <li>Une vraie structure pour progresser</li>
                  <li>Un lien direct avec les coachs & l‚Äôasso</li>
                  <li>Des r√©ductions / avantages selon la formule</li>
                  <li>Une communaut√© motiv√©e, pas juste un club</li>
                </ul>
              </div>
            </div>

            <div class="plans-title">Les 5 formules membres RSL (ordre croissant)</div>
          </div>

          <div class="products-grid">

            <!-- 1) STARTER -->
            <article class="product-card">
              <div class="product-img">Starter ‚Äî entrer dans la ligue</div>
              <div class="product-title">Starter ‚Äî 50 CHF/an</div>
              <div class="product-meta">
                Le pack id√©al pour <b>rejoindre officiellement la RSL</b>, soutenir la sc√®ne et profiter d‚Äôavantages concrets.
                <ul>
                  <li>Statut <b>membre officiel RSL</b></li>
                  <li><b>Cours RSL √† 20 CHF</b> au lieu de 30 CHF</li>
                  <li><b>‚Äì10% sur le livret de tricks</b></li>
                  <li><b>‚Äì10% dans les boutiques partenaires</b></li>
                  <li>Sticker / support visuel RSL inclus</li>
                </ul>
              </div>
              <div class="product-price">50 CHF/an <span>Pack d‚Äôentr√©e</span></div>

              <!-- ‚úÖ FIX: plus de startMembership ici, on ouvre juste le popup -->
              <a href="#" class="product-btn js-open-plan">Choisir Starter</a>

              <div class="badge-small">Pour commencer & soutenir</div>

              <div class="product-popup-content" style="display:none">
                <div class="product-modal-content">
                  <h2>Formule STARTER ‚Äî 50 CHF/an</h2>
                  <p>La formule <b>Starter</b>, c‚Äôest le pack d‚Äôentr√©e pour faire partie de la RSL, soutenir la ligue et d√©j√† b√©n√©ficier de vrais avantages.</p>
                  <h3>Id√©ale pour</h3>
                  <ul>
                    <li>Parents / proches qui veulent soutenir la sc√®ne</li>
                    <li>Riders qui d√©butent et veulent d√©j√† √™tre membres</li>
                    <li>Ceux qui veulent aider sans encore s‚Äôengager sur un gros pack</li>
                  </ul>
                  <h3>Ce que tu re√ßois</h3>
                  <ul>
                    <li>Statut de <b>membre officiel RSL</b></li>
                    <li><b>Cours RSL √† 20 CHF</b> au lieu de 30 CHF</li>
                    <li><b>‚Äì10% sur le livret de tricks</b></li>
                    <li><b>‚Äì10% dans les boutiques partenaires</b></li>
                    <li>Sticker / support visuel RSL inclus</li>
                  </ul>
                  <p style="margin-top:10px;">
                    <a href="#" class="product-btn"
                       onclick="startMembership('starter','yearly','https://buy.stripe.com/6oU6oA6Wt0gi8MK6RGeUU00'); return false;">
                      Payer & devenir membre Starter ‚Äî 50 CHF/an
                    </a>
                  </p>
                </div>
              </div>
            </article>

            <!-- 2) RIDER -->
            <article class="product-card highlight">
              <div class="product-ribbon">Populaire</div>
              <div class="product-img">Rider ‚Äî progresser toute l‚Äôann√©e</div>
              <div class="product-title">Rider ‚Äî 80 CHF/an</div>
              <div class="product-meta">
                Pour <b>rider r√©guli√®rement</b> avec la RSL, profiter de sessions organis√©es et b√©n√©ficier d‚Äôavantages renforc√©s.
                <ul>
                  <li>Acc√®s prioritaire √† certaines sessions & √©v√©nements</li>
                  <li><b>Cours RSL √† 20 CHF</b> au lieu de 30 CHF</li>
                  <li><b>‚Äì15% sur le livret de tricks</b></li>
                  <li><b>‚Äì15% dans les boutiques partenaires RSL</b></li>
                  <li>Sticker / support visuel RSL inclus</li>
                </ul>
              </div>
              <div class="product-price">80 CHF/an <span>Progression r√©guli√®re</span></div>

              <!-- ‚úÖ FIX: plus de startMembership ici, on ouvre juste le popup -->
              <a href="#" class="product-btn js-open-plan">Choisir Rider</a>

              <div class="badge-small">Riders actifs & motiv√©s</div>

              <div class="product-popup-content" style="display:none">
                <div class="product-modal-content">
                  <h2>Formule RIDER ‚Äî 80 CHF/an</h2>
                  <p>La formule <b>Rider</b>, c‚Äôest pour ceux qui veulent participer r√©guli√®rement √† la vie de la ligue et profiter d‚Äôun cadre pour progresser toute l‚Äôann√©e.</p>
                  <h3>Concr√®tement</h3>
                  <ul>
                    <li>Acc√®s prioritaire √† certaines sessions & √©v√©nements RSL</li>
                    <li><b>Cours RSL √† 20 CHF</b> au lieu de 30 CHF</li>
                    <li><b>‚Äì15% sur le livret de tricks</b></li>
                    <li><b>‚Äì15% dans les boutiques partenaires RSL</b></li>
                  </ul>
                  <p style="margin-top:10px;">
                    <a href="#" class="product-btn"
                       onclick="startMembership('rider','yearly','https://buy.stripe.com/5kQaEQ5Sp3sufb8dg4eUU01'); return false;">
                      Payer & devenir membre Rider ‚Äî 80 CHF/an
                    </a>
                  </p>
                </div>
              </div>
            </article>

            <!-- 3) SUPPORT -->
            <article class="product-card">
              <div class="product-img">Pro / Soutien ‚Äî financer la ligue</div>
              <div class="product-title">Pro / Soutien ‚Äî 15 CHF/mois ou 149 CHF/an</div>
              <div class="product-meta">
                Pour les <b>marques, commerces, parents, riders adultes</b> qui veulent soutenir financi√®rement la ligue.
                <ul>
                  <li><b>Livret de tricks offert</b></li>
                  <li><b>Cours RSL √† 20 CHF</b> au lieu de 30 CHF</li>
                  <li><b>‚Äì15% dans les boutiques partenaires RSL</b></li>
                  <li>Sticker / support visuel RSL inclus</li>
                </ul>
              </div>
              <div class="product-price">15 CHF/mois ou 149 CHF/an <span>Soutien officiel</span></div>
              <a href="#" class="product-btn js-open-plan">Choisir Soutien</a>
              <div class="badge-small">Parents, commerces, partenaires</div>

              <div class="product-popup-content" style="display:none">
                <div class="product-modal-content">
                  <h2>Formule PRO / SOUTIEN</h2>
                  <p>Choisis ton type de soutien :</p>
                  <p style="margin-top:10px; display:flex; flex-direction:column; gap:8px;">
                    <a href="#" class="product-btn"
                       onclick="startMembership('support','monthly','https://buy.stripe.com/dRm6oA5Spd34gfcfoceUU06'); return false;">
                      Soutenir ‚Äî 15 CHF/mois
                    </a>
                    <a href="#" class="product-btn"
                       onclick="startMembership('support','yearly','https://buy.stripe.com/cNicMY3Kh8MO0gea3SeUU03'); return false;">
                      Soutenir ‚Äî 149 CHF/an
                    </a>
                  </p>
                </div>
              </div>
            </article>

            <!-- 4) PROGRESSION -->
            <article class="product-card">
              <div class="product-img">Progression ‚Äî gros d√©veloppement</div>
              <div class="product-title">Progression ‚Äî 289 CHF/an ou 25 CHF/mois</div>
              <div class="product-meta">
                Pour un <b>gros boost</b> : programme, suivi, et <b>15 cours inclus</b>.
                <ul>
                  <li><b>15 cours inclus</b></li>
                  <li>Apr√®s : cours √† <b>20 CHF</b></li>
                  <li><b>‚Äì15% mat√©riel</b> & partenaires</li>
                  <li><b>T-shirt RSL offert</b></li>
                </ul>
              </div>
              <div class="product-price">289 CHF/an ou 25 CHF/mois <span>D√©veloppement</span></div>
              <a href="#" class="product-btn js-open-plan">Choisir Progression</a>
              <div class="badge-small">Riders en d√©veloppement</div>

              <div class="product-popup-content" style="display:none">
                <div class="product-modal-content">
                  <h2>Formule PROGRESSION</h2>
                  <p>Choisis ton mode de paiement :</p>
                  <p style="margin-top:10px; display:flex; flex-direction:column; gap:8px;">
                    <a href="#" class="product-btn"
                       onclick="startMembership('progression','yearly','https://buy.stripe.com/8x26oAa8F1kmbYWgsgeUU08'); return false;">
                      üîÅ Payer ‚Äî 289 CHF/an
                    </a>
                    <a href="#" class="product-btn"
                       onclick="startMembership('progression','monthly','https://buy.stripe.com/00wfZa94Bfbc4wugsgeUU05'); return false;">
                      üî• Payer ‚Äî 25 CHF/mois
                    </a>
                  </p>
                </div>
              </div>
            </article>

            <!-- 5) PREMIUM -->
            <article class="product-card">
              <div class="product-img">Premium ‚Äî √©lite & encadrement maximal</div>
              <div class="product-title">Premium ‚Äî 490 CHF/an ou 43 CHF/mois</div>
              <div class="product-meta">
                Pour un <b>d√©veloppement maximum</b> : <b>tous les cours gratuits</b> + avantages events.
                <ul>
                  <li><b>Tous les cours gratuits</b></li>
                  <li><b>‚Äì50% sur events</b></li>
                  <li><b>Suivi avanc√©</b></li>
                  <li><b>T-shirt + Sweat</b> offerts</li>
                </ul>
              </div>
              <div class="product-price">490 CHF/an ou 43 CHF/mois <span>√âlite</span></div>
              <a href="#" class="product-btn js-open-plan">Choisir Premium</a>
              <div class="badge-small">Riders tr√®s engag√©s</div>

              <div class="product-popup-content" style="display:none">
                <div class="product-modal-content">
                  <h2>Formule PREMIUM</h2>
                  <p>Choisis ton mode de paiement :</p>
                  <p style="margin-top:10px; display:flex; flex-direction:column; gap:8px;">
                    <a href="#" class="product-btn"
                       onclick="startMembership('premium','yearly','https://buy.stripe.com/5kQ7sE2Gd4wygfc1xmeUU07'); return false;">
                      üîÅ Payer ‚Äî 490 CHF/an
                    </a>
                    <a href="#" class="product-btn"
                       onclick="startMembership('premium','monthly','https://buy.stripe.com/3cIaEQ5Sp4wy5Ay5NCeUU04'); return false;">
                      üî• Payer ‚Äî 43 CHF/mois
                    </a>
                  </p>
                </div>
              </div>
            </article>

          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="footer-mini">
    <p class="copy">¬© 2026 ‚Äî Romandie Scooter League / Association Ride4Style Montreux. Tous droits r√©serv√©s.</p>
  </footer>

  <!-- MODAL GLOBALE -->
  <div class="product-modal" id="productModal">
    <div class="product-modal-backdrop"></div>
    <div class="product-modal-panel">
      <button class="product-modal-close" aria-label="Fermer">‚úï</button>
      <div id="productModalInner"></div>
    </div>
  </div>

  <script>
    /* ===== Th√®me (clair/sombre) ===== */
    (function(){
      const STORAGE_KEY='rsl-theme';
      const body=document.body;
      const btn=document.getElementById('themeToggle');

      function applyTheme(theme){
        if(theme==='light'){
          body.classList.add('theme-light');
          if(btn) btn.textContent='‚òÄÔ∏è';
        }else{
          body.classList.remove('theme-light');
          if(btn) btn.textContent='üåô';
        }
      }

      let saved=null;
      try{ saved=localStorage.getItem(STORAGE_KEY); }catch(e){}
      if(!saved){
        const prefersLight=window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
        saved=prefersLight?'light':'dark';
      }
      applyTheme(saved);

      if(btn){
        btn.addEventListener('click', ()=>{
          const current=body.classList.contains('theme-light')?'light':'dark';
          const next=current==='light'?'dark':'light';
          applyTheme(next);
          try{ localStorage.setItem(STORAGE_KEY,next); }catch(e){}
        });
      }
    })();

    /* ===== Supabase singleton + anti-doublon + lock ===== */
    function waitForEnv(timeoutMs=3500){
      return new Promise((resolve)=>{
        const start=Date.now();
        (function tick(){
          const ok=!!(window.env && window.env.SUPABASE_URL && window.env.SUPABASE_ANON);
          if(ok) return resolve(true);
          if(Date.now()-start>timeoutMs) return resolve(false);
          setTimeout(tick,30);
        })();
      });
    }

    function getSupa(){
      if(window.__rslSupa) return window.__rslSupa;
      const url  = window.env?.SUPABASE_URL  || "https://jynxifufaauoxwzjapzq.supabase.co";
      const anon = window.env?.SUPABASE_ANON || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp5bnhpZnVmYWF1b3h3emphcHpxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzODI2NzcsImV4cCI6MjA3Njk1ODY3N30.vFPGhGakPIM3Xg5rn8_BrAXl6oJMJOssO780C9nXmr4";
      if(!window.supabase?.createClient) return null;
      window.__rslSupa = window.supabase.createClient(url, anon);
      return window.__rslSupa;
    }

    async function startMembership(planCode, billingPeriod, stripeUrl){
      await waitForEnv(3500);
      const sb=getSupa();

      if(!sb){
        alert("Erreur technique : Supabase n‚Äôest pas disponible. R√©essaie plus tard.");
        return;
      }

      try{
        const { data, error } = await sb.auth.getUser();
        const user = (!error && data?.user) ? data.user : null;

        if(!user){
          alert("Tu dois √™tre connect√© pour prendre un abonnement RSL.");
          window.location.href="access.html";
          return;
        }

        if(!stripeUrl){
          alert("Lien de paiement indisponible pour cette formule. Contacte la RSL.");
          return;
        }

        if(window.__rslMembershipLock) return;
        window.__rslMembershipLock=true;

        // r√©utilise une demande non pay√©e (√©vite doublons)
        let membershipId=null;
        try{
          const { data: existing } = await sb
            .from("rsl_memberships")
            .select("id, created_at")
            .eq("user_id", user.id)
            .eq("membership_code", planCode)
            .eq("is_paid", false)
            .order("created_at", { ascending:false })
            .limit(1);

          if(existing && existing[0]) membershipId = existing[0].id;
        }catch(e){}

        if(!membershipId){
          const row={ user_id:user.id, membership_code:planCode, is_paid:false };
          const { data: inserted, error: insertErr } = await sb
            .from("rsl_memberships")
            .insert(row)
            .select("id")
            .single();

          if(insertErr){
            console.error(insertErr);
            alert("Impossible d‚Äôenregistrer ton abonnement. R√©essaie ou contacte la RSL.");
            window.__rslMembershipLock=false;
            return;
          }
          membershipId = inserted?.id || null;
        }

        if(membershipId){
          try{ localStorage.setItem("rsl_last_membership_id", String(membershipId)); }catch(e){}
        }

        window.location.href=stripeUrl;

      }catch(e){
        console.error("startMembership error:", e);
        alert("Une erreur est survenue. R√©essaie ou contacte la RSL.");
      }finally{
        window.__rslMembershipLock=false;
      }
    }

    /* ===== Vid√©o de fond ===== */
    (function(){
      const vids=[
        "https://jynxifufaauoxwzjapzq.supabase.co/storage/v1/object/public/videos_rsl/trottvideo1.mp4",
        "https://jynxifufaauoxwzjapzq.supabase.co/storage/v1/object/public/videos_rsl/trottvideo2.mp4"
      ];
      const v=document.getElementById('rslBg');
      if(!v) return;
      const s=document.createElement('source');
      s.src=vids[Math.floor(Math.random()*vids.length)];
      s.type="video/mp4";
      v.appendChild(s);

      const start=()=>{
        try{
          v.playbackRate=0.6;
          const p=v.play();
          if(p && p.catch) p.catch(()=>{});
        }catch(e){}
      };
      start();

      document.addEventListener('visibilitychange',()=>{
        if(document.hidden){ v.pause(); } else { start(); }
      });
    })();

    /* ===== Menu mobile ===== */
    (function(){
      const menuBtn=document.getElementById('menuBtn');
      const mobile=document.getElementById('mobileMenu');
      if(!menuBtn || !mobile) return;

      menuBtn.addEventListener('click',e=>{
        e.stopPropagation();
        mobile.classList.add('open');
        mobile.setAttribute('aria-hidden','false');
      });
      mobile.querySelector('.mobile-dim')?.addEventListener('click',()=>{
        mobile.classList.remove('open');
        mobile.setAttribute('aria-hidden','true');
      });
      document.addEventListener('keydown',e=>{
        if(e.key==='Escape'){
          mobile.classList.remove('open');
          mobile.setAttribute('aria-hidden','true');
        }
      });
    })();

    /* ===== Modal plans ===== */
    (function(){
      const modal=document.getElementById('productModal');
      const modalInner=document.getElementById('productModalInner');
      if(!modal || !modalInner) return;

      const openModal=(html)=>{
        modalInner.innerHTML=html;
        modal.classList.add('open');
      };
      const closeModal=()=>{
        modal.classList.remove('open');
        modalInner.innerHTML="";
      };

      document.addEventListener('click',function(e){
        const btn=e.target.closest('.js-open-plan');
        if(btn){
          e.preventDefault();
          const card=btn.closest('.product-card');
          const popup=card?.querySelector('.product-popup-content');
          if(popup) openModal(popup.innerHTML);
        }
        if(e.target.closest('.product-modal-close') || e.target.classList.contains('product-modal-backdrop')){
          closeModal();
        }
      });

      document.addEventListener('keydown',function(e){
        if(e.key==="Escape"){
          if(modal.classList.contains('open')) closeModal();
        }
      });
    })();
  </script>
</body>
</html>
