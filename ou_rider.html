<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>O√π rider ? ‚Äî Romandie Scooter League</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Fonts + styles globaux -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/common.css"/>

  <style>
    :root{ --g:#16a34a; --b:#0ea5e9; --r:#ef4444; --v:#7c3aed; }

    html,body{height:100%;margin:0}
    body{font-family:Outfit,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#000;display:flex;flex-direction:column}
    main{flex:1}

    /* ===== Vid√©o de fond ===== */
    .rsl-bg-wrap{position:fixed;inset:0;z-index:0;pointer-events:none}
    .rsl-bg-video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;background:#000;z-index:0}
    .rsl-bg-dim{position:absolute;inset:0;z-index:1;background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,.75))}

    /* ===== NAV ===== */
    nav.nav{position:sticky;top:0;z-index:1000;background:rgba(0,0,0,.65);backdrop-filter:blur(8px)}
    nav.nav .container{max-width:1320px;margin:0 auto;padding:12px 28px}
    nav.nav .row{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px;color:#fff;text-decoration:none}
    .brand img{height:48px;border-radius:10px}
    .brand span{font-weight:800;letter-spacing:.2px;font-size:17px}
    nav.nav ul{display:flex;align-items:center;gap:26px}
    nav.nav ul li a{font-weight:600;color:#e8f0ea;font-size:17px;letter-spacing:.2px;white-space:nowrap}
    nav.nav ul li a:hover{color:#22c55e}
    .cta{display:flex;align-items:center;gap:12px}
    #menuBtn{display:none;align-items:center;justify-content:center;gap:8px;padding:10px 12px;font-size:18px;line-height:1;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(34,197,94,.12);color:#22c55e;cursor:pointer}
    #menuBtn:hover{background:rgba(34,197,94,.22)}
    @media (max-width:990px){nav.nav ul{display:none !important}.cta a{display:none !important}#menuBtn{display:inline-flex}}

    /* ===== Bandeau titre ===== */
    .page-mini-hero{color:#fff;padding:18px 0 8px;position:relative;z-index:10}
    .page-mini-hero .container{max-width:1200px;margin:0 auto;padding:0 24px}
    .page-mini-hero h1{margin:0 0 6px;font-size:clamp(26px,4vw,38px);font-weight:800}
    .page-mini-hero p{margin:0;opacity:.95}

    /* ===== Carte ===== */
    main .container{max-width:1200px;margin:0 auto;padding:0 24px 90px;position:relative;z-index:10}
    .map-wrap{position:relative}
    #map{
      height:73vh;
      min-height:480px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:#0b1220;
      z-index:2;
    }
    @media (max-width:900px){
      main .container{padding:0 12px 90px}
      #map{height:calc(100vh - 40vh);min-height:58vh}
    }

    .leaflet-pane,.leaflet-top,.leaflet-bottom{z-index:2}

    /* ===== Boutons carte ===== */
    .map-controls{position:absolute;top:12px;right:12px;z-index:3000;display:flex;gap:10px}
    .btn-tool{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;border-radius:12px;font-weight:800;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.65);color:#fff;backdrop-filter:saturate(110%) blur(4px);box-shadow:0 10px 30px rgba(0,0,0,.35);cursor:pointer}
    @media (max-width:900px){.map-controls{display:none}}

    /* ===== Filtres ===== */
    #filtersDim{position:fixed;inset:0;z-index:4000;background:rgba(0,0,0,.45);opacity:0;pointer-events:none;transition:opacity .18s ease;backdrop-filter:blur(2px)}
    #filtersSheet{position:fixed;top:10px;right:10px;z-index:4001;width:min(88vw,380px);max-height:calc(100vh - 20px);overflow:auto;background:rgba(0,0,0,.78);color:#fff;border:1px solid rgba(255,255,255,.15);border-radius:16px;padding:12px;transform:translateY(-8px) scale(.98);opacity:0;pointer-events:none;transition:.2s cubic-bezier(.2,.8,.2,1)}
    .chip{display:flex;align-items:center;gap:10px;padding:10px 12px;margin:8px 0;border-radius:12px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);font-weight:700}
    .chip input{width:18px;height:18px}
    .dot{width:14px;height:14px;border-radius:50%;border:2px solid #fff}
    .dot.g{background:var(--g)} .dot.b{background:var(--b)} .dot.r{background:var(--r)} .dot.v{background:var(--v)}
    .show-filters #filtersDim{opacity:1;pointer-events:auto}
    .show-filters #filtersSheet{opacity:1;pointer-events:auto;transform:none}

    /* ===== Outils mobile ===== */
    .mobile-tools{position:fixed;left:0;right:0;bottom:58px;z-index:3500;display:none;justify-content:center;gap:10px}
    .mobile-tools .btn-tool{padding:10px 14px}
    @media (max-width:900px){.mobile-tools{display:flex}}

    /* ===== Footer & Coach ===== */
    .footer-mini .copy{color:#9aa5b1;text-align:center;border-top:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.2);margin:0;padding:24px 0 28px;font-size:14px;z-index:10;position:relative}
    .coach-fab{display:none;position:fixed;right:16px;bottom:16px;z-index:80;padding:12px 14px;border-radius:12px;background:linear-gradient(180deg,#22c55e,#16a34a);color:#062312;font-weight:800;text-decoration:none;box-shadow:0 10px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.15)}
    @media (min-width:991px){.coach-fab{display:inline-flex}}
    
    /* ===== Menu mobile (panneau) ===== */
    .mobile-sheet{position:fixed;inset:0;display:none;z-index:3000}
    .mobile-sheet.open{display:block}
    .mobile-sheet .mobile-dim{position:absolute;inset:0;background:rgba(0,0,0,.5)}
    .mobile-sheet .mobile-panel{
      position:absolute;top:0;right:0;height:100%;width:82vw;max-width:360px;
      background:#0b1220;padding:22px 18px;display:flex;flex-direction:column;gap:12px;
      border-left:1px solid rgba(255,255,255,.08);box-shadow:-12px 0 30px rgba(0,0,0,.35)
    }
    .mobile-sheet .mobile-panel a{color:#eaf5ee;text-decoration:none;font-weight:700;padding:8px 0}
    .mobile-sheet .mobile-panel hr{border:0;height:1px;background:rgba(255,255,255,.1);margin:10px 0}
  </style>
</head>
<body>

  <!-- ===== Vid√©o de fond ===== -->
  <div class="rsl-bg-wrap" aria-hidden="true">
    <video class="rsl-bg-video" id="rslBg" autoplay muted loop playsinline preload="auto" poster="images/hero-poster.jpg">
      <source src="images/trottvideo2.mp4" type="video/mp4">
    </video>
    <div class="rsl-bg-dim"></div>
  </div>

  <!-- ===== NAV ===== -->
  <nav class="nav">
    <div class="container">
      <div class="row">
        <a class="brand" href="index.html"><img src="images/logo_rsl.png" alt="Logo RSL"/><span>RSL ‚Äî Romandie Scooter League</span></a>
        <ul>
          <li><a href="cours.html">Cours</a></li>
          <li><a href="formation.html">Formation RSL</a></li>
          <li><a href="ou_rider.html">O√π rider ?</a></li>
          <li><a href="evenements.html">√âv√©nements</a></li>
          <li><a href="disciplines.html">Disciplines</a></li>
          <li><a href="comite.html">Comit√©</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
        <div class="cta">
          <a class="btn dark" href="compte.html">Mon compte</a>
          <a class="btn green" href="cours.html">Cours RSL</a>
          <a class="btn green" href="membres.html">Devenir membre</a>
          <button id="menuBtn">‚ò∞</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- ===== MENU MOBILE (manquait dans ta version pr√©c√©dente) ===== -->
  <div class="mobile-sheet" id="mobileMenu" aria-hidden="true">
    <div class="mobile-dim"></div>
    <nav class="mobile-panel">
      <a href="cours.html">Cours</a>
      <a href="formation.html">Formation RSL</a>
      <a href="ou_rider.html">O√π rider ?</a>
      <a href="evenements.html">√âv√©nements</a>
      <a href="disciplines.html">Disciplines</a>
      <a href="comite.html">Comit√©</a>
      <a href="contact.html">Contact</a>
      <hr/>
      <a href="membres.html">Devenir membre</a>
      <a href="conditions.html">Conditions g√©n√©rales</a>
      <a href="compte.html">Mon compte</a>
      <a href="coach.html" class="coach-link">üë®‚Äçüè´ Je suis coach</a>
    </nav>
  </div>

  <!-- Bandeau -->
  <section class="page-mini-hero">
    <div class="container">
      <h1>O√π rider ?</h1>
      <p>Carte des <b>skateparks</b>, <b>shops partenaires</b> et <b>lieux de cours RSL</b>.</p>
    </div>
  </section>

  <!-- ===== CARTE ===== -->
  <main>
    <div class="container">
      <div class="map-wrap">
        <div class="map-controls">
          <button class="btn-tool" id="filtersTrigger">Filtres</button>
          <button class="btn-tool" id="locateBtnPC">Ma position</button>
        </div>
        <div id="map"></div>
      </div>
    </div>
  </main>

  <!-- Filtres -->
  <div id="filtersDim"></div>
  <aside id="filtersSheet" aria-label="Filtres carte">
    <h3>Filtres</h3>
    <div class="chip"><span class="dot g"></span><input type="checkbox" id="f-int" checked><label for="f-int">Cours RSL (int√©rieur)</label></div>
    <div class="chip"><span class="dot b"></span><input type="checkbox" id="f-ext" checked><label for="f-ext">Cours RSL (ext√©rieur)</label></div>
    <div class="chip"><span class="dot r"></span><input type="checkbox" id="f-shop" checked><label for="f-shop">Shops partenaires</label></div>
    <div class="chip"><span class="dot v"></span><input type="checkbox" id="f-park" checked><label for="f-park">Skateparks</label></div>
  </aside>

  <!-- Mobile tools -->
  <div class="mobile-tools">
    <button class="btn-tool" id="filtersFab">Filtres</button>
    <button class="btn-tool" id="locateFab">Ma position</button>
  </div>

  <!-- ===== FOOTER ===== -->
  <footer class="footer-mini"><p class="copy">¬© 2026 ‚Äî RSL Romandie Scooter League. Tous droits r√©serv√©s.</p></footer>
  <a href="coach.html" class="coach-fab">üë®‚Äçüè´ Je suis coach</a>

  <script>
  // ===== Vid√©o =====
  window.addEventListener('DOMContentLoaded', () => {
    const v=document.getElementById('rslBg');
    if(!v) return;
    const start=()=>{ try{ v.playbackRate=0.6; const p=v.play(); if(p?.catch) p.catch(()=>{});}catch(e){} };
    start();
    document.addEventListener('visibilitychange',()=>{ if(document.hidden) v.pause(); else start(); });
  });

  // ===== Carte Leaflet =====
  let map;
  try{
    map=L.map('map').setView([46.8,8.2],8);
    const osm=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'¬© OpenStreetMap'}).addTo(map);
    osm.on('tileerror',()=>{ L.tileLayer('https://tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png',{maxZoom:19,attribution:'¬© OpenStreetMap (FR)'}).addTo(map); });
  }catch(err){
    console.error('Erreur init Leaflet:', err);
  }

  const icon=(c,e)=>L.divIcon({className:'rsl-marker',html:`<div style="width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:${c};border:2px solid #fff;color:#fff;font-size:18px">${e}</div>`,iconSize:[34,34],iconAnchor:[17,17]});
  const icons={int:icon('#16a34a','üè´'),ext:icon('#0ea5e9','üõº'),shop:icon('#ef4444','üè™'),park:icon('#7c3aed','üõπ')};
  const spots=[
    {t:'int',n:'Cours RSL ‚Äî Montreux (indoor)',lat:46.433,lng:6.910},
    {t:'int',n:'Cours RSL ‚Äî Lausanne (La Fi√®vre)',lat:46.536,lng:6.626},
    {t:'ext',n:'Cours RSL ‚Äî Vidy (outdoor)',lat:46.523,lng:6.610},
    {t:'ext',n:'Cours RSL ‚Äî Bulle',lat:46.616,lng:7.057},
    {t:'ext',n:'Cours RSL ‚Äî Yverdon',lat:46.778,lng:6.640},
    {t:'shop',n:'JF Rideshop',lat:46.433,lng:6.910},
    {t:'shop',n:'Sportmania',lat:46.512,lng:6.561},
    {t:'park',n:'Skatepark de Sion',lat:46.233,lng:7.360},
    {t:'park',n:'Skatepark de Vevey',lat:46.461,lng:6.844}
  ];
  const layers={int:L.layerGroup().addTo(map),ext:L.layerGroup().addTo(map),shop:L.layerGroup().addTo(map),park:L.layerGroup().addTo(map)};
  spots.forEach(s=>L.marker([s.lat,s.lng],{icon:icons[s.t]}).bindPopup(`<b>${s.n}</b>`).addTo(layers[s.t]));
  const chks={int:document.getElementById('f-int'),ext:document.getElementById('f-ext'),shop:document.getElementById('f-shop'),park:document.getElementById('f-park')};
  const apply=()=>{for(const k in layers){chks[k].checked?map.addLayer(layers[k]):map.removeLayer(layers[k]);}};Object.values(chks).forEach(c=>c.addEventListener('change',apply));apply();

  // ===== Filtres & position =====
  const body=document.body,dim=document.getElementById('filtersDim');
  const close=()=>body.classList.remove('show-filters');
  document.getElementById('filtersFab').onclick=()=>body.classList.toggle('show-filters');
  document.getElementById('filtersTrigger').onclick=()=>body.classList.toggle('show-filters');
  dim.onclick=close;
  const locate=()=>{if(!navigator.geolocation)return alert('G√©olocalisation indisponible.');
    navigator.geolocation.getCurrentPosition(p=>{const {latitude,longitude}=p.coords;
      L.circleMarker([latitude,longitude],{radius:6,color:'#38bdf8',fillColor:'#38bdf8',fillOpacity:.9,weight:2}).addTo(map);
      map.setView([latitude,longitude],14);
    },()=>alert("Impossible d'obtenir ta position."));
  };
  document.getElementById('locateFab').onclick=locate;
  document.getElementById('locateBtnPC').onclick=locate;

  // ===== Contour de la Suisse (vert RSL) =====
  fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
    .then(res => res.json())
    .then(data => {
      const suisse = data.features.find(f => f.properties.ADMIN === 'Switzerland');
      if (!suisse) return;
      L.geoJSON(suisse, {
        style: {
          color: '#22c55e',
          weight: 3.5,
          opacity: 0.95,
          fillColor: '#22c55e',
          fillOpacity: 7.20
        }
      }).addTo(map);
    })
    .catch(err => console.error('Erreur contour Suisse:', err));

  // ===== Menu burger =====
  const menuBtn=document.getElementById('menuBtn');
  const mobile=document.getElementById('mobileMenu');
  menuBtn?.addEventListener('click',e=>{e.stopPropagation();mobile.classList.add('open');mobile.setAttribute('aria-hidden','false');});
  mobile?.querySelector('.mobile-dim')?.addEventListener('click',()=>{mobile.classList.remove('open');mobile.setAttribute('aria-hidden','true');});
  document.addEventListener('keydown',e=>{if(e.key==='Escape'){mobile.classList.remove('open');mobile.setAttribute('aria-hidden','true');}});
  </script>
</body>
</html>